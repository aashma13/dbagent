# DB Agent

DB agent is a FastAPI-based service that provides a natural language interface to query the Chinook database. Users can ask questions in plain English, and the service will return relevant information from the database.

## Project Description

DB Agent is an intelligent database query assistant that allows users to interact with the Chinook database using natural language. The Chinook database is a sample database that represents a digital music store, including tables for artists, albums, tracks, invoices, and customers.



[![‚ñ∂Ô∏è Watch Demo Video](app_demo/thumbnail.jpg)](https://github.com/aashma13/dbagent/main/app_demo/dbagent-demo.mp4)


### Features

- Natural language processing for database queries with ChatAI on streamlit appp
- RESTful API endpoint for chat interactions and other Frontend integration
- CORS support for web client integration
- Automatic cleanup of temporary database files
- Streamlit Chat APP with UI

## Prerequisites

- Python 3.12+
- uv (Python package installer and virtual environment manager)
- Chinook database

---

* `pyproject.toml` ‚Üí defines the project and dependencies
* `uv.lock` ‚Üí lockfile with exact dependency versions

---

## Steps to Run the Project with `uv`



### 1. Clone the repository:
```bash
git clone <repository-url>
cd dbagent
```


### 2. Install `uv` (if not already installed)

```bash
curl -Ls https://astral.sh/uv/install.sh | sh
```

Or with pipx:

```bash
pipx install uv
```

---

### 3. Create Virtual Environment

```bash
uv venv
```

optional

```bash
source .venv/bin/activate
```

---

### 4. Install Dependencies

```bash
uv pip install -r pyproject.toml
```

---


_Before Running Make sure you have `.env` file_

```.env
DB_BACKEND=mysql
DB_HOST=
DB_PORT=             
DB_USER=
DB_PASSWORD=
DB_NAME=
TOP_K=19
LLM_MODEL=gpt-4o-mini
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-proj-as......
```

### 5. Run the Application

```bash
uv run main.py
```

This will start the server on:

```
http://0.0.0.0:9000
```

* Open docs: `http://127.0.0.1:9000/docs`
* Test endpoint: `POST /chat`

---

## Docker Support

### Build Docker Image

```bash
docker build -t dbagent .
```

### Run Docker Container

```bash
docker run --env-file .env -p 9000:9000 dbagent
```

### use dockercompose (Optionaly)

```bash
docker-compose up --build

```


```bash
docker-compose down

```


---
**Note**



Here is the same note, formatted as a section suitable for a `README.md` file or inline Dockerfile comment:

---

### ‚ö†Ô∏è Note: Connecting from Docker Container to MySQL on Host

If your Docker container needs to connect to a **MySQL server running on your host machine**, be aware of the following:

* Inside a Docker container, `localhost` or `127.0.0.1` refers to the **container itself**, not your host.
* Attempting to connect to `localhost:3306` or `127.0.0.1:3306` will try to reach a MySQL server **inside the container**, which usually doesn't exist.

#### ‚úÖ How to Connect from Container to Host MySQL

1. **Use a special hostname**:

   * On **Linux**: use `--add-host=host.docker.internal:host-gateway` in your `docker run` command or Docker Compose file.
   * On **macOS** and **Windows**: `host.docker.internal` is supported by default.

2. **Ensure MySQL is configured for remote access**:

   * Edit your MySQL config (`my.cnf` or `mysqld.cnf`) and set:

     ```ini
     bind-address = 0.0.0.0
     ```
   * Restart the MySQL server after making changes.

3. **Allow the MySQL user to connect remotely**:

   ```sql
   GRANT ALL PRIVILEGES ON *.* TO 'your_user'@'%' IDENTIFIED BY 'your_password';
   FLUSH PRIVILEGES;
   ```

4. **Allow traffic through port 3306**:

   * Ensure no firewall (e.g., UFW or iptables) is blocking port `3306` on the host machine.

---
--- 


## üß™ Optional: Check Installed Packages

```bash
uv pip list
```

---

## üßπ Need to Reset?

To start clean:

```bash
rm -rf .venv
uv venv
```


The server will start on `http://0.0.0.0:9000` with hot reload enabled.

## API Usage

### Chat Endpoint

Send POST requests to `/chat` with a JSON body containing your query:

```bash
curl -X POST "http://localhost:9000/chat" \
     -H "Content-Type: application/json" \
     -d '{"query": "Show me all best selling song."}'
```


## Running a Streamlit web app

```bash
streamlit run app.py
```


## Demo questions for Streamlit app

#### Conversation 1: Artist & Albums
Q1: Who are the top 5 artists with the most albums?

Follow-up: How many tracks does each of their albums have?

Follow-up: What's the total revenue generated by each of these artists?

Follow-up: Which genre is most common among their tracks?

#### Conversation 2: Customer Purchases
Q1: Who are the top 3 customers by total invoice amount?

Follow-up: What city and country are they from?

Follow-up: What genres do they buy the most?

Follow-up: What is the average amount per invoice for each of them?

#### Conversation 3: Genre & Revenue
Q1: Which music genre has the highest number of tracks?

Follow-up: What‚Äôs the total revenue generated by that genre?

Follow-up: Which artist contributes most to that genre‚Äôs revenue?

Follow-up: Are those tracks mostly from a specific album or spread out?
